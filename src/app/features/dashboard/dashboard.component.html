<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

<div class="card">
    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <button pButton pRipple label="Nuevo Producto" icon="pi pi-plus" class="p-button-success"
                (click)="openNew()"></button>
        </ng-template>
    </p-toolbar>

    <ng-container *ngIf="products$ | async as products">
        <p-table [value]="products" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }"
            styleClass="p-datatable-striped" [paginator]="true" [rows]="10">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width:25%">Título</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr>
                    <td>{{ product.title }}</td>
                    <td>{{ product.price | currency:'USD' }}</td>
                    <td>{{ product.stock }}</td>
                    <td>
                        <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2"
                            (click)="editProduct(product)"></button>
                        <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning"
                            (click)="deleteProduct(product)"></button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </ng-container>
</div>


<p-dialog [(visible)]="productDialogVisible" [style]="{ width: '450px' }"
    [header]="isEditMode ? 'Editar Producto' : 'Nuevo Producto'" [modal]="true" class="p-fluid" (onHide)="hideDialog()">

    <form [formGroup]="productForm">
        <div class="formgrid grid p-3">

            <div class="field col-12">
                <label for="title" class="font-bold">Título</label>
                <input type="text" pInputText id="title" formControlName="title" required autofocus />
                <small class="p-error" *ngIf="productForm.get('title')?.invalid && productForm.get('title')?.touched">
                    El título es obligatorio.
                </small>
            </div>

            <div class="field col-12">
                <label for="description" class="font-bold">Descripción</label>
                <textarea id="description" pInputTextarea formControlName="description" required rows="3"></textarea>
                <small class="p-error"
                    *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
                    La descripción es obligatoria.
                </small>
            </div>

            <div class="field col-12 md:col-6">
                <label for="price" class="font-bold">Precio</label>
                <p-inputNumber id="price" formControlName="price" mode="currency" currency="USD"
                    locale="en-US"></p-inputNumber>
                <small class="p-error" *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
                    El precio es obligatorio y debe ser mayor a 0.
                </small>
            </div>

            <div class="field col-12 md:col-6">
                <label for="stock" class="font-bold">Stock</label>
                <p-inputNumber id="stock" formControlName="stock" [min]="0"></p-inputNumber>
                <small class="p-error" *ngIf="productForm.get('stock')?.invalid && productForm.get('stock')?.touched">
                    El stock es obligatorio.
                </small>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
            (click)="hideDialog()"></button>
        <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveProduct()"
            [disabled]="productForm.invalid"></button>
    </ng-template>
</p-dialog>